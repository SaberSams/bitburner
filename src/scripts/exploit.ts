import { NS } from "@ns";
import { deepScan, IServers } from "./lib/deepScan";

/** @param {NS} ns */
export async function main(ns: NS): Promise<void> {
  const exploits = {
    "BruteSSH.exe": ns.fileExists("BruteSSH.exe"),
    "FTPCrack.exe": ns.fileExists("FTPCrack.exe"),
    "HTTPWorm.exe": ns.fileExists("HTTPWorm.exe"),
    "relaySMTP.exe": ns.fileExists("relaySMTP.exe"),
    "SQLInject.exe": ns.fileExists("SQLInject.exe"),
  }
  const servers:IServers = deepScan(ns, ns.getHostname(), 100)

  Object.keys(servers).forEach(async (hostname) => {
    if(exploits["BruteSSH.exe"]){ ns.brutessh(hostname) }
    if(exploits["FTPCrack.exe"]){ ns.ftpcrack(hostname) }
    if(exploits["HTTPWorm.exe"]){ ns.httpworm(hostname) }
    if(exploits["relaySMTP.exe"]){ ns.relaysmtp(hostname) }
    if(exploits["SQLInject.exe"]){ ns.sqlinject(hostname) }
    if(!servers[hostname].hasAdminRights && 
      (servers[hostname].openPortCount >= servers[hostname].numOpenPortsRequired)){
      ns.nuke(hostname)
    }
    if(!servers[hostname].backdoorInstalled && servers[hostname].hasAdminRights){
      //await ns.installBackdoor(hostname)
    }
  });
}